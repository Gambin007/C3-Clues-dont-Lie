<!--
  FILE: app.html
  PURPOSE: Main application shell and layout container
  
  This is the protected main application page that users see after logging in.
  It provides:
  - A sidebar navigation menu with links to different sections
  - A top bar showing system name and current logged-in user
  - A main content area where route pages are dynamically rendered
  - Session protection (redirects to login if not authenticated)
  - Initialization of the hash-based router system
  
  WHY: Acts as a single-page application shell that handles navigation and
  layout. All page content is dynamically loaded via the router based on
  URL hash fragments (#/dashboard, #/cases, etc.). This keeps the app
  structure clean and allows for easy navigation without full page reloads.
-->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fallverwaltungssystem Detektei Gruber</title>
  <link rel="stylesheet" href="assets/styles.css" />
</head>
<body class="app-page">
  <div class="app-layout">
    <!-- Sidebar -->
    <aside class="sidebar">
      <nav class="sidebar-nav">
        <a href="#/dashboard" class="nav-item" data-route="/dashboard">
          <span class="nav-icon">ğŸ“Š</span>
          <span class="nav-label">Dashboard</span>
        </a>
        <a href="#/cases" class="nav-item" data-route="/cases">
          <span class="nav-icon">ğŸ“</span>
          <span class="nav-label">Fallakte MÃ¼ller</span>
        </a>
        <a href="#/todo" class="nav-item" data-route="/todo">
          <span class="nav-icon">âœ…</span>
          <span class="nav-label">To Do Liste</span>
        </a>
        <a href="#/search" class="nav-item" data-route="/search">
          <span class="nav-icon">ğŸ”</span>
          <span class="nav-label">Suche</span>
        </a>
        <a href="#/map" class="nav-item" data-route="/map">
          <span class="nav-icon">ğŸ—ºï¸</span>
          <span class="nav-label">Karte</span>
        </a>
        <a href="#/settings" class="nav-item" data-route="/settings">
          <span class="nav-icon">âš™ï¸</span>
          <span class="nav-label">Einstellungen</span>
        </a>
      </nav>
      <div class="sidebar-footer">
        <p>SYS v0.9.4</p>
        <p>Nur fÃ¼r interne Nutzung</p>
      </div>
    </aside>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Top Bar -->
      <header class="topbar">
        <div class="topbar-left">
          <h2 id="system-name">Fallverwaltungssystem Detektei Gruber</h2>
        </div>
        <div class="topbar-right">
          <span class="user-info">Angemeldet als <strong id="current-username">â€”</strong></span>
        </div>
      </header>

      <!-- Page Content -->
      <main class="page-content" id="page-content">
        <div class="loading">LÃ¤dt...</div>
      </main>
    </div>
  </div>

  <script type="module">
    import { initRouter } from './js/router.js';
    import { checkSession } from './js/session.js';
    import { loadConfig } from './js/store.js';

    // Check authentication
    try {
      const session = checkSession();
      if (!session) {
        window.location.href = 'index.html';
        throw new Error('No session'); // Prevent further execution
      }

      // Set username in topbar
      if (session && session.username) {
        const usernameEl = document.getElementById('current-username');
        if (usernameEl) {
          usernameEl.textContent = session.username;
        }
      }

      // Load system name from config
      loadConfig().then(config => {
        if (config?.systemName) {
          const systemNameEl = document.getElementById('system-name');
          if (systemNameEl) {
            systemNameEl.textContent = config.systemName;
          }
          document.title = config.systemName;
        }
      }).catch(error => {
        console.error('Failed to load config:', error);
      });

      // Initialize router
      initRouter();
    } catch (error) {
      if (error.message !== 'No session') {
        console.error('App initialization error:', error);
      }
    }
  </script>
</body>
</html>
